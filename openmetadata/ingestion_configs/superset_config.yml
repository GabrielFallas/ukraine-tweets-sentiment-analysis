# ==============================================
# CONFIGURACIÓN DE INGESTA - APACHE SUPERSET
# ==============================================
# Este archivo define la configuración para que OpenMetadata
# pueda conectarse a Apache Superset y extraer metadatos de los
# dashboards, charts y sus conexiones de datos.

source:
    type: superset
    serviceName: ukraine_superset_service
    serviceConnection:
        config:
            type: Superset
            # URL del servidor de Superset
            hostPort: http://superset:8088

            # Configuración de conexión
            connection:
                # Usuario y contraseña de Superset
                username: admin
                password: admin
                # Provider de autenticación (db = base de datos)
                provider: db

    sourceConfig:
        config:
            type: DashboardMetadata

            # Filtros para dashboards
            dashboardFilterPattern:
                includes:
                    - "ukraine.*"
                    - ".*sentiment.*"

            # Filtros para charts
            chartFilterPattern:
                includes:
                    - ".*"

            # Incluir información de propietarios
            includeOwners: true

            # Incluir tags y descripciones
            includeTags: true

            # Configuración de linaje de datos
            # Esto establecerá las conexiones entre Superset y las fuentes de datos
            dbServiceNames:
                - ukraine_druid_service # Conectar con el servicio de Druid

            # Marcar dashboards eliminados
            markDeletedDashboards: true

# Configuración de la base de datos de metadatos de Superset
# OpenMetadata se conecta a la BD de Superset para extraer información adicional
metadataDatabase:
    type: Postgres
    config:
        # Conexión a la base de datos de Superset
        hostPort: postgres_superset_db:5432
        username: superset
        password: superset123
        database: superset

# Configuración del sink (destino) - OpenMetadata
sink:
    type: metadata-rest
    config:
        # URL del servidor de OpenMetadata
        hostPort: http://openmetadata-server:8585/api

# Configuración del workflow
workflowConfig:
    # Habilitar logs detallados
    loggerLevel: INFO

    # Configuración del servidor de OpenMetadata
    openMetadataServerConfig:
        hostPort: http://openmetadata-server:8585/api
        apiVersion: v1
        # Autenticación
        authProvider: openmetadata
        securityConfig:
            jwtToken: ""

    # Configuración de linaje
    # Esto ayuda a establecer las relaciones entre dashboards y datos
    lineageInformation:
        dbServiceNames:
            - ukraine_druid_service

# Metadata adicional
metadata:
    description: "Pipeline de ingesta para Apache Superset - Dashboards de Análisis de Sentimiento"
    owner: "data_engineering_team"
    tags:
        - ukraine
        - sentiment-analysis
        - superset
        - dashboards
        - visualization

    # Información sobre el propósito de los dashboards
    notes: |
        Este pipeline ingesta los metadatos de los dashboards de Superset
        que visualizan el análisis de sentimiento de tweets sobre la guerra
        en Ucrania. Incluye:

        - Distribución de sentimientos (positivo, neutral, negativo)
        - Tendencias temporales de sentimiento
        - Análisis geográfico (si disponible)
        - Palabras más frecuentes por sentimiento
        - Métricas de engagement (retweets, likes)

        El linaje de datos establecido muestra la conexión:
        Spark (procesamiento) -> Druid (almacenamiento) -> Superset (visualización)
