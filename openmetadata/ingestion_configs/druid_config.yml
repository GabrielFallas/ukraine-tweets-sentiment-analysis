# ==============================================
# CONFIGURACIÓN DE INGESTA - APACHE DRUID
# ==============================================
# Este archivo define la configuración para que OpenMetadata
# pueda conectarse a Apache Druid y extraer metadatos de los
# datasources (tablas) disponibles.

source:
    type: druid
    serviceName: ukraine_druid_service
    serviceConnection:
        config:
            type: Druid
            # URL del coordinador de Druid
            hostPort: druid:8888
            # Nombre de la base de datos (por defecto es 'druid')
            databaseName: druid

    sourceConfig:
        config:
            type: DatabaseMetadata
            # Marcar tablas como fuentes de datos activas
            markDeletedTables: true
            # Incluir vistas en el catálogo
            includeViews: true
            # Incluir tags de las tablas
            includeTags: true

            # Filtros para especificar qué tablas incluir/excluir
            # En este caso, queremos catalogar el datasource de sentimiento
            schemaFilterPattern:
                includes:
                    - "druid"

            tableFilterPattern:
                includes:
                    - "ukraine_sentiment_tweets"
                    - "ukraine_.*" # Cualquier tabla que empiece con ukraine_

# Configuración del sink (destino) - OpenMetadata
sink:
    type: metadata-rest
    config:
        # URL del servidor de OpenMetadata
        # Usar el nombre del servicio en Docker
        hostPort: http://openmetadata-server:8585/api

# Configuración del workflow
workflowConfig:
    # Habilitar logs detallados
    loggerLevel: INFO

    # Configuración de profiling (opcional)
    # Esto analizará los datos para obtener estadísticas
    openMetadataServerConfig:
        hostPort: http://openmetadata-server:8585/api
        apiVersion: v1
        # Autenticación (usando básica por defecto)
        authProvider: openmetadata
        securityConfig:
            jwtToken: ""

# Metadata adicional
metadata:
    description: "Pipeline de ingesta para Apache Druid - Análisis de Sentimiento de Tweets sobre Ucrania"
    owner: "data_engineering_team"
    tags:
        - ukraine
        - sentiment-analysis
        - druid
        - real-time-analytics
